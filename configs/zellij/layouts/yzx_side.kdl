layout {
    tab_template name="ui" {
        pane size=1 borderless=true {
           plugin location="file:~/.config/yazelix/configs/zellij/zjstatus.wasm" {
               format_left   "{mode} {tabs}"
               format_center "#[fg=#ff0088,bold]{session} #[fg=#00ff88,bold]{swap_layout}"
               format_right  "#[fg=#ffff00][shell: {command_shell}] [editor: {command_editor}] #[fg=#00ccff,bold]YAZELIX " // {datetime}
               format_space  ""
               
               border_enabled  "false"
               hide_frame_for_single_pane "true"
               
               mode_normal  "#[bg=#00ff88,fg=#000000,bold] NORMAL "
               mode_tmux    "#[bg=#ffff00,fg=#000000,bold] TMUX "
               mode_session "#[bg=#ff6600,fg=#000000,bold] SESSION "
               mode_scroll  "#[bg=#ff0088,fg=#ffffff,bold] SCROLL "
               
               tab_normal   "#[fg=#ffff00] {name} "
               tab_active   "#[bg=#ff6600,fg=#000000,bold] {name} "
               
               datetime        "#[fg=#bb88ff,bold] {format} "
               datetime_format "%H:%M %d/%m"
               
               command_shell_command "bash -c 'echo ${YAZELIX_DEFAULT_SHELL:-$(basename $SHELL)}'"
               
               command_editor_command "bash -c 'echo $EDITOR'"
               command_editor_format "{stdout}"
               command_editor_interval "300"
               command_shell_format "{stdout}"
               command_shell_interval "300"
           }
        }
        children
        pane size=1 borderless=true {
           plugin location="zellij:status-bar"
        }
    }

    default_tab_template {
        pane size=1 borderless=true {
           plugin location="file:~/.config/yazelix/configs/zellij/zjstatus.wasm" {
               format_left   "{mode} {tabs}"
               format_center "#[fg=#ff0088,bold]{session} #[fg=#00ff88,bold]{swap_layout}"
               format_right  "#[fg=#ffff00][shell: {command_shell}] [editor: {command_editor}] #[fg=#00ccff,bold]YAZELIX " // {datetime}
               format_space  ""
               
               border_enabled  "false"
               hide_frame_for_single_pane "true"
               
               mode_normal  "#[bg=#00ff88,fg=#000000,bold] NORMAL "
               mode_tmux    "#[bg=#ffff00,fg=#000000,bold] TMUX "
               mode_session "#[bg=#ff6600,fg=#000000,bold] SESSION "
               mode_scroll  "#[bg=#ff0088,fg=#ffffff,bold] SCROLL "
               
               tab_normal   "#[fg=#ffff00] {name} "
               tab_active   "#[bg=#ff6600,fg=#000000,bold] {name} "
               
               datetime        "#[fg=#bb88ff,bold] {format} "
               datetime_format "%H:%M %d/%m"
               
               command_shell_command "bash -c 'echo ${YAZELIX_DEFAULT_SHELL:-$(basename $SHELL)}'"
               
               command_editor_command "bash -c 'echo $EDITOR'"
               command_editor_format "{stdout}"
               command_editor_interval "300"
               command_shell_format "{stdout}"
               command_shell_interval "300"
           }
        }
        pane split_direction="vertical" {
            pane name="sidebar" {
                command "yazi"
            	size "100%"
            }
        }
        pane size=1 borderless=true {
           plugin location="zellij:status-bar"
        }
    }
}

keybinds {
    shared {
        // Use original Zellij keybinding but with Ctrl+Shift modifier
        // Original: Ctrl+O, now: Ctrl+Shift+O to avoid Helix conflicts
        unbind "Ctrl o"
        bind "Ctrl Shift o" { SwitchToMode "Session"; }

        // Use original Zellij keybinding but with Ctrl+Shift modifier
        // Original: Ctrl+S, now: Ctrl+Shift+S to avoid Helix conflicts
        unbind "Ctrl s"
        bind "Ctrl Shift s" { SwitchToMode "Scroll"; }

        // Previously: Alt + i (in helix: shrink_selection)
        unbind "Alt i"
        // Move tab left (new)
        bind "Alt Shift H" { MoveTab "Left"; }

        // Previously: Alt + o (in helix: expand_selection)
        unbind "Alt o"
        // Move tab right (new)
        bind "Alt Shift L" { MoveTab "Right"; }

        // Previously: Alt + n (in helix: select_next_sibling)
        bind "Alt m" { NewPane; }
        unbind "Alt n"

        // Previously: Ctrl + b (in helix: move_page_up)
        // Alt+number: Go directly to tab 1-9 (tmux style)
        bind "Alt 1" { GoToTab 1; }
        bind "Alt 2" { GoToTab 2; }
        bind "Alt 3" { GoToTab 3; }
        bind "Alt 4" { GoToTab 4; }
        bind "Alt 5" { GoToTab 5; }
        bind "Alt 6" { GoToTab 6; }
        bind "Alt 7" { GoToTab 7; }
        bind "Alt 8" { GoToTab 8; }
        bind "Alt 9" { GoToTab 9; }

        // Not a remap, just for ease of use
        bind "Alt Shift f" { ToggleFocusFullscreen; SwitchToMode "Normal"; }

        // Tab navigation: Ctrl+Alt+H/L (uppercase) vs Move mode: Ctrl+Shift+h (lowercase)
        bind "Ctrl Alt H" { GoToPreviousTab; }
        bind "Ctrl Alt L" { GoToNextTab; }

        // Alt+q/w: Walk (focus) left/right between tabs
        bind "Alt q" { GoToPreviousTab; }
        bind "Alt w" { GoToNextTab; }

        // Unbind Alt+( and Alt+)
        // fixes selection cycling in helix for alacritty and wezterm
        // does not work for kitty or ghostty
        unbind "Alt ("
        unbind "Alt )"
    }

    // Remap all Zellij default Ctrl keybindings to Ctrl+Shift to avoid conflicts
    shared_except "locked" {
        unbind "Ctrl g"
        bind "Ctrl Shift g" { SwitchToMode "Locked"; }
    }
    
    shared_except "pane" "locked" {
        unbind "Ctrl p"
        bind "Ctrl Shift p" { SwitchToMode "Pane"; }
    }
    
    shared_except "resize" "locked" {
        unbind "Ctrl n"  
        bind "Ctrl Shift n" { SwitchToMode "Resize"; }
    }
    
    shared_except "scroll" "locked" {
        unbind "Ctrl s"
        bind "Ctrl Shift s" { SwitchToMode "Scroll"; }
    }
    
    shared_except "session" "locked" {
        unbind "Ctrl o"
        bind "Ctrl Shift o" { SwitchToMode "Session"; }
    }
    
    shared_except "tab" "locked" {
        unbind "Ctrl t"
        bind "Ctrl Shift t" { SwitchToMode "Tab"; }
    }
    
    shared_except "move" "locked" {
        unbind "Ctrl h"
        bind "Ctrl Shift h" { SwitchToMode "Move"; }
    }
    
    shared_except "tmux" "locked" {
        unbind "Ctrl b"
        bind "Ctrl Shift b" { SwitchToMode "Tmux"; }
    }

    shared_except "locked" {
        unbind "Ctrl q"
        bind "Ctrl Shift q" { Quit; }
    }

    locked {
        unbind "Ctrl g"
        bind "Ctrl Shift g" { SwitchToMode "Normal"; }
    }

    pane {
        unbind "Ctrl p"
        bind "Ctrl Shift p" { SwitchToMode "Normal"; }
    }

    resize {
        unbind "Ctrl n"
        bind "Ctrl Shift n" { SwitchToMode "Normal"; }
    }

    session {
        // Exit session mode
        unbind "Ctrl o"
        bind "Ctrl Shift o" { SwitchToMode "Normal"; }
    }

    scroll {
        // Exit scroll mode
        unbind "Ctrl s"
        bind "Ctrl Shift s" { SwitchToMode "Normal"; }
    }

    tab {
        unbind "Ctrl t"
        bind "Ctrl Shift t" { SwitchToMode "Normal"; }
    }

    move {
        unbind "Ctrl h"
        bind "Ctrl Shift h" { SwitchToMode "Normal"; }
    }

    tmux {
        // Exit tmux mode
        unbind "Ctrl b"
        bind "Ctrl Shift b" { SwitchToMode "Normal"; }
    }
}
